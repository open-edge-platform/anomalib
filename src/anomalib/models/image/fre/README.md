# FRE: A Fast Method For Anomaly Detection And Segmentation

This is the implementation of [FRE](https://papers.bmvc2023.org/0614.pdf) paper.

Model Type: Segmentation

## Description

Fast anomaly classification algorithm that consists of a deep feature extraction stage followed by anomaly classification stage comprising a shallow linear autoencoder.

### Feature Extraction

Features are extracted by feeding the images through a ResNet50 backbone, which was pre-trained on ImageNet. The output of an intermediate layer (layer3 by default) of the network is used to obtain a semantic feature vector with a fixed length of 65536.

### Anomaly Detection

In the anomaly classification stage, a shallow linear autoencoder is trained on the features of the chosen layer. A feature-reconstruction scores (norm of the error between the reconstructed output of the autoencoder and the original high-dimensional feature) is calculated as the anomaly score. Anomaly map is generated by reshaping and resizing the error tensor to match the input image dimension.

## Usage

`anomalib train --model Fre --data anomalib.data.MVTec`

## Benchmark

All results gathered with seed `42`.

## [MVTec AD Dataset](https://www.mvtec.com/company/research/datasets/mvtec-ad)

> Note: Metrics for ResNet 18 were calculated with pooling kernel size of 2 while for Wide ResNet 50, kernel size of 4 was used.

### Image-Level AUC

|                |  Avg  | Carpet | Grid  | Leather | Tile  | Wood  | Bottle | Cable | Capsule | Hazelnut | Metal Nut | Pill  | Screw | Toothbrush | Transistor | Zipper |
| -------------- | :---: | :----: | :---: | :-----: | :---: | :---: | :----: | :---: | :-----: | :------: | :-------: | :---: | :---: | :--------: | :--------: | :----: |
| ResNet-18      | 0.936 | 0.817  | 0.736 |  0.993  | 0.966 | 0.977 |   1    | 0.956 |  0.944  |  0.994   |   0.922   | 0.961 | 0.89  |   0.969    |   0.939    | 0.969  |
| Wide ResNet-50 | 0.943 | 0.855  | 0.784 |  0.997  | 0.995 | 0.975 | 0.999  | 0.969 |  0.924  |  0.978   |   0.939   | 0.962 | 0.873 |   0.969    |   0.971    | 0.961  |

### Image F1 Score

|                |  Avg  | Carpet | Grid  | Leather | Tile  | Wood | Bottle | Cable | Capsule | Hazelnut | Metal Nut | Pill  | Screw | Toothbrush | Transistor | Zipper |
| -------------- | :---: | :----: | :---: | :-----: | :---: | :--: | :----: | :---: | :-----: | :------: | :-------: | :---: | :---: | :--------: | :--------: | :----: |
| ResNet-18      | 0.943 | 0.895  | 0.871 |  0.978  | 0.958 | 0.96 |   1    | 0.935 |  0.965  |  0.966   |   0.942   | 0.956 | 0.914 |   0.966    |   0.868    | 0.964  |
| Wide ResNet-50 | 0.950 | 0.915  | 0.87  |  0.995  | 0.988 | 0.96 | 0.992  | 0.939 |  0.965  |  0.971   |   0.942   | 0.956 | 0.906 |   0.966    |   0.914    | 0.971  |
